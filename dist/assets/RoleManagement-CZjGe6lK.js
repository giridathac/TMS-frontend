import{_ as q,e as T,r as a,s as z,h as u,i as e,x as D,j as h,t as d,p as L,z as f,G as p,O as N,w as V,N as A,E as c,P as w,F as O,l as G,J,o as r,n as Y}from"./index-Bqden_Qr.js";import{s as y}from"./superadmin.service-ymcF6AST.js";const H={class:"bg-white rounded-xl shadow-sm border border-gray-200"},K={class:"p-6"},Q={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},W={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},X={class:"text-lg font-medium text-gray-900 mb-4"},Z={class:"flex items-center justify-between py-2"},ee={class:"relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in"},te={key:0,class:"flex items-center justify-between py-2"},se={class:"relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in"},oe={class:"flex justify-end space-x-3 pt-3"},le={class:"lg:col-span-2"},ae={class:"bg-white rounded-xl shadow-sm border border-gray-200"},re={class:"p-4 border-b border-gray-200 flex justify-between items-center"},ne={class:"text-xs px-2 py-1 bg-indigo-100 text-indigo-800 rounded-full"},ie={class:"overflow-hidden"},de={class:"min-w-full divide-y divide-gray-200"},ce={class:"bg-white divide-y divide-gray-200"},ue={key:0,class:"animate-pulse"},pe={key:1},ge={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},me={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ve={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},fe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ye={class:"relative inline-block w-10 mr-2 align-middle select-none"},xe=["id","checked","onChange","disabled"],be=["for"],_e={class:"text-xs ml-1"},he={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},we={class:"flex justify-end space-x-2"},ke=["onClick"],Re=["onClick","disabled"],Ce={class:"flex justify-end space-x-3"},Ee={__name:"RoleManagement",setup(Se){const{success:x,error:g}=T(),b=a([]),$=a(!1),k=a(!1),R=a(!1),n=a(!1),C=a(null),m=a(!1),_=a(null),l=a({role_name:"",description:"",can_register_publicly:!0,status:"active"}),i=a({});z(async()=>{await E()});const E=async()=>{try{const s=await y.getRoles();console.log("Service: Roles response:",s),s.success&&Array.isArray(s.data)?b.value=s.data:(console.error("API Error fetching roles:",s.message),g(s.message||"Failed to fetch roles."))}catch(s){console.error("Error fetching roles:",s),g("A network error occurred. Please try again.")}},F=()=>(i.value={},l.value.role_name.trim()||(i.value.role_name="Role name is required"),l.value.description.trim()||(i.value.description="Description is required"),Object.keys(i.value).length===0),j=async()=>{if(F()){k.value=!0;try{if(n.value){const s=await y.updateRole(C.value,l.value);if(s.success)x("Role updated successfully");else throw new Error(s.message)}else{const s=await y.createRole(l.value);if(s.success)x("Role created successfully");else throw new Error(s.message)}S(),await E()}catch(s){console.error("Error saving role:",s),g(s.message||"Failed to save role")}finally{k.value=!1}}},M=async s=>{try{const o=s.status==="active"?"inactive":"active",v=await y.updateRole(s.id,{status:o});if(v.success)s.status=o,x(`Role status updated to ${o}`);else throw new Error(v.message)}catch(t){console.error("Error toggling role status:",t),g("Failed to update role status")}},U=s=>{n.value=!0,C.value=s.id,l.value={role_name:s.role_name,description:s.description,can_register_publicly:s.can_register_publicly,status:s.status}},B=()=>{n.value=!1,C.value=null,S()},I=s=>{_.value=s,m.value=!0},P=async()=>{if(_.value){R.value=!0;try{const s=await y.deleteRole(_.value);if(s.success)x("Role deleted successfully");else throw new Error(s.message);m.value=!1,_.value=null,await E()}catch(s){console.error("Error deleting role:",s),g(s.message||"Failed to delete role")}finally{R.value=!1}}},S=()=>{l.value={role_name:"",description:"",can_register_publicly:!0,is_active:!0},i.value={}};return(s,t)=>(r(),u("div",H,[t[21]||(t[21]=e("div",{class:"p-6 border-b border-gray-200"},[e("h3",{class:"text-lg font-semibold text-gray-900 font-roboto"},"User Role Management"),e("p",{class:"text-sm text-gray-600 mt-1"},"Create and manage user roles")],-1)),e("div",K,[e("div",Q,[e("div",W,[e("h4",X,d(n.value?"Edit Role":"Create New Role"),1),e("form",{onSubmit:L(j,["prevent"]),class:"space-y-4"},[e("div",null,[t[6]||(t[6]=e("label",{for:"roleName",class:"block text-sm font-medium text-gray-700 mb-2"},[p(" Role Name "),e("span",{class:"text-red-500"},"*")],-1)),f(N,{id:"roleName",modelValue:l.value.role_name,"onUpdate:modelValue":t[0]||(t[0]=o=>l.value.role_name=o),type:"text",placeholder:"Enter role name",error:i.value.role_name,required:""},null,8,["modelValue","error"])]),e("div",null,[t[7]||(t[7]=e("label",{for:"description",class:"block text-sm font-medium text-gray-700 mb-2"},[p(" Description "),e("span",{class:"text-red-500"},"*")],-1)),f(N,{id:"description",modelValue:l.value.description,"onUpdate:modelValue":t[1]||(t[1]=o=>l.value.description=o),type:"text",placeholder:"Enter role description",error:i.value.description,required:""},null,8,["modelValue","error"])]),e("div",Z,[t[9]||(t[9]=e("label",{for:"canRegister",class:"text-sm font-medium text-gray-700"}," Allow Public Registration ",-1)),e("div",ee,[V(e("input",{type:"checkbox",id:"canRegister","onUpdate:modelValue":t[2]||(t[2]=o=>l.value.can_register_publicly=o),class:"toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"},null,512),[[A,l.value.can_register_publicly]]),t[8]||(t[8]=e("label",{for:"canRegister",class:"toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"},null,-1))])]),n.value?(r(),u("div",te,[t[11]||(t[11]=e("label",{for:"roleStatus",class:"text-sm font-medium text-gray-700"}," Role Status ",-1)),e("div",se,[V(e("input",{type:"checkbox",id:"roleStatus","onUpdate:modelValue":t[3]||(t[3]=o=>s.roleStatusComputed=o),class:"toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"},null,512),[[A,s.roleStatusComputed]]),t[10]||(t[10]=e("label",{for:"roleStatus",class:"toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"},null,-1))])])):h("",!0),e("div",oe,[n.value?(r(),D(w,{key:0,type:"button",variant:"secondary",onClick:B},{default:c(()=>[...t[12]||(t[12]=[p(" Cancel ",-1)])]),_:1})):h("",!0),f(w,{type:"submit",variant:"primary",loading:k.value},{default:c(()=>[p(d(n.value?"Update Role":"Create Role"),1)]),_:1},8,["loading"])])],32)]),e("div",le,[e("div",ae,[e("div",re,[t[13]||(t[13]=e("h4",{class:"font-medium text-gray-900"},"Available Roles",-1)),e("span",ne,d(b.value.length)+" Roles ",1)]),e("div",ie,[e("table",de,[t[16]||(t[16]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Role Name "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Description "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Public Reg. "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status "),e("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),e("tbody",ce,[$.value?(r(),u("tr",ue,[...t[14]||(t[14]=[e("td",{colspan:"5",class:"px-6 py-4"},[e("div",{class:"h-4 bg-gray-200 rounded w-3/4"})],-1)])])):b.value.length===0?(r(),u("tr",pe,[...t[15]||(t[15]=[e("td",{colspan:"5",class:"px-6 py-4 text-center text-sm text-gray-500"}," No roles found. Create your first role. ",-1)])])):h("",!0),(r(!0),u(O,null,G(b.value,o=>(r(),u("tr",{key:o.id,class:"hover:bg-gray-50"},[e("td",ge,d(o.role_name),1),e("td",me,d(o.description),1),e("td",ve,[e("span",{class:Y(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",o.can_register_publicly?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},d(o.can_register_publicly?"Yes":"No"),3)]),e("td",fe,[e("div",ye,[e("input",{type:"checkbox",id:`toggle-${o.id}`,checked:o.status==="active",onChange:v=>M(o),class:"toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer",disabled:["superadmin","templeadmin","devotee","volunteer"].includes(o.role_name)},null,40,xe),e("label",{for:`toggle-${o.id}`,class:"toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"},null,8,be)]),e("span",_e,d(o.status==="active"?"Active":"Inactive"),1)]),e("td",he,[e("div",we,[e("button",{onClick:v=>U(o),class:"text-indigo-600 hover:text-indigo-900 focus:outline-none"}," Edit ",8,ke),e("button",{onClick:v=>I(o.id),class:"text-red-600 hover:text-red-900 focus:outline-none",disabled:["superadmin","templeadmin","devotee","volunteer"].includes(o.role_name)}," Delete ",8,Re)])])]))),128))])])])])])])]),m.value?(r(),D(J,{key:0,onClose:t[5]||(t[5]=o=>m.value=!1)},{header:c(()=>[...t[17]||(t[17]=[e("h3",{class:"text-lg font-medium text-gray-900"},"Confirm Delete",-1)])]),default:c(()=>[...t[18]||(t[18]=[e("div",{class:"py-4"},[e("p",{class:"text-gray-600"},"Are you sure you want to delete this role? This action cannot be undone.")],-1)])]),footer:c(()=>[e("div",Ce,[f(w,{onClick:t[4]||(t[4]=o=>m.value=!1),variant:"secondary"},{default:c(()=>[...t[19]||(t[19]=[p(" Cancel ",-1)])]),_:1}),f(w,{onClick:P,variant:"danger",loading:R.value},{default:c(()=>[...t[20]||(t[20]=[p(" Delete ",-1)])]),_:1},8,["loading"])])]),_:1})):h("",!0)]))}},Ve=q(Ee,[["__scopeId","data-v-1dc2d008"]]);export{Ve as default};
