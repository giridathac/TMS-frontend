import{q as G,W as J,e as K,r as k,c as S,C as Q,s as X,h as r,j as g,i as e,z as Z,E as ee,H as te,G as m,t as d,y as a,F as y,l as f,w as T,v as E,k as oe,A as se,o as n,n as U}from"./index-Bqden_Qr.js";const le={class:"min-h-screen bg-gray-50"},ae={key:0,class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-4"},re={class:"bg-white shadow-sm border-b border-gray-200 rounded-2xl"},ne={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},de={class:"flex items-center justify-between"},ie={class:"text-gray-600 mt-1"},ue={key:0,class:"text-indigo-600 font-medium"},ce={key:1,class:"text-indigo-600 font-medium"},ve={class:"flex items-center space-x-4"},pe={class:"bg-indigo-50 px-4 py-2 rounded-lg border border-indigo-200"},ge={class:"text-indigo-800 font-medium"},me={class:"text-indigo-600 text-sm ml-2"},xe={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},be={class:"bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden mb-8"},we={class:"p-6"},ye={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},fe={class:"flex flex-wrap gap-2"},he=["onClick","disabled"],_e={class:"flex flex-wrap gap-2"},ke=["onClick","disabled"],Se={key:0,class:"mb-6 p-4 bg-gray-50 border border-gray-200 rounded-lg"},De={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ce=["disabled","max"],Re=["disabled","min","max"],Le={class:"border-t border-gray-200 pt-6"},Ae={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-4"},Pe={class:"flex items-center space-x-3 mt-4 md:mt-0"},Te={class:"relative"},Fe=["disabled"],Me=["value"],ze=["disabled"],Ie={key:0,class:"animate-spin -ml-1 mr-2 h-5 w-5 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ve={key:1,class:"mr-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Be=["disabled"],je={key:0,class:"animate-spin -ml-1 mr-2 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},$e={key:1,class:"mr-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Ee={key:1,class:"mt-4 p-4 bg-red-50 border border-red-200 rounded-md"},Ue={class:"flex"},Ne={class:"ml-3"},Oe={class:"mt-1 text-sm text-red-700"},qe={class:"ml-auto pl-3"},He={key:0,class:"bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden mb-8"},We={class:"p-6 border-b border-gray-200"},Ye={class:"flex items-center justify-between"},Ge={class:"text-gray-600 mt-1"},Je={class:"text-sm text-gray-500"},Ke={class:"overflow-x-auto"},Qe={class:"min-w-full divide-y divide-gray-200"},Xe={class:"bg-gray-50"},Ze={class:"bg-white divide-y divide-gray-200"},et={key:0,class:"px-6 py-3 bg-gray-50 border-t border-gray-200"},tt={class:"text-sm text-gray-600"},ot={class:"bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden"},st={class:"p-6"},lt={class:"flex flex-wrap gap-2"},at={key:0,class:"inline-flex items-center px-3 py-1.5 rounded-full text-sm bg-indigo-100 text-indigo-800"},rt={class:"inline-flex items-center px-3 py-1.5 rounded-full text-sm bg-indigo-100 text-indigo-800"},nt={key:0},dt={class:"inline-flex items-center px-3 py-1.5 rounded-full text-sm bg-indigo-100 text-indigo-800"},it={class:"inline-flex items-center px-3 py-1.5 rounded-full text-sm bg-indigo-100 text-indigo-800"},vt={__name:"ApprovalStatusReport",setup(ut){const D=Q();se();const F=G(),s=J(),{showToast:h}=K(),v=k("monthly"),x=k("all"),_=k("pdf"),i=k(""),u=k(""),N=()=>{const o=new Date,t=new Date;t.setDate(o.getDate()-30),u.value=o.toISOString().split("T")[0],i.value=t.toISOString().split("T")[0]},M=[{label:"Weekly",value:"weekly"},{label:"Monthly",value:"monthly"},{label:"Yearly",value:"yearly"},{label:"Custom Range",value:"custom"}],z=[{label:"All Status",value:"all"},{label:"Approved",value:"approved"},{label:"Pending",value:"pending"},{label:"Rejected",value:"rejected"}],I=[{label:"PDF",value:"pdf"},{label:"CSV",value:"csv"},{label:"Excel",value:"excel"}],C=S(()=>{var o;return D.params.tenantId||((o=F.user)==null?void 0:o.id)||localStorage.getItem("current_tenant_id")}),b=S(()=>D.query.from==="superadmin"),p=S(()=>D.query.tenants?D.query.tenants.split(","):[C.value]),O=S(()=>new Date().toISOString().split("T")[0]),R=S(()=>v.value==="custom"?i.value&&u.value&&new Date(i.value)<=new Date(u.value):!0),q=o=>{v.value=o,s.clearError();const t=new Date,c=new Date;o==="weekly"?c.setDate(t.getDate()-7):o==="monthly"?c.setDate(t.getDate()-30):o==="yearly"&&c.setDate(t.getDate()-365),o!=="custom"&&(i.value=c.toISOString().split("T")[0],u.value=t.toISOString().split("T")[0])},H=o=>{x.value=o,s.clearError()},L=o=>{const t=M.find(c=>c.value===o);return t?t.label:"Unknown"},A=o=>{const t=z.find(c=>c.value===o);return t?t.label:"Unknown"},V=o=>{const t=I.find(c=>c.value===o);return t?t.label:"Unknown"},w=o=>o?new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",B=()=>{const o={dateRange:v.value,startDate:i.value,endDate:u.value,role:""};return x.value!=="all"&&(o.status=x.value),b.value&&p.value.length>1?(o.entityIds=p.value,o.isSuperAdmin=!0):o.entityId=C.value,o},W=async()=>{if(R.value)try{const o=B();console.log("Previewing Approval Status report with parameters:",{tenants:b.value&&p.value.length>1?p.value.length:1,dateRange:L(v.value),status:A(x.value),period:`${w(i.value)} - ${w(u.value)}`}),await s.getApprovalStatusPreview(o),s.hasReportData?h(`Preview loaded: ${s.reportPreview.totalRecords} records found`,"success"):h("No data found for the selected criteria","info")}catch(o){console.error("Preview failed:",o),h(`Preview failed: ${o.message}`,"error")}},Y=async()=>{if(R.value)try{const o={...B(),format:_.value};console.log("Downloading Approval Status report:",{tenants:b.value&&p.value.length>1?p.value.length:1,dateRange:L(v.value),status:A(x.value),format:V(_.value),period:`${w(i.value)} - ${w(u.value)}`});const t=await s.downloadApprovalStatusReport(o);h(`Report downloaded successfully: ${t.filename}`,"success")}catch(o){console.error("Download failed:",o),h(`Download failed: ${o.message}`,"error")}};return X(()=>{N(),s.clearReportData()}),(o,t)=>{var j;const c=te("router-link");return n(),r("div",le,[b.value?(n(),r("div",ae,[Z(c,{to:"/superadmin/reports",class:"inline-flex items-center px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"},{default:ee(()=>[...t[4]||(t[4]=[e("svg",{class:"mr-2 h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),m(" Back to SuperAdmin Reports ",-1)])]),_:1})])):g("",!0),e("div",re,[e("div",ne,[e("div",de,[e("div",null,[t[6]||(t[6]=e("h1",{class:"text-2xl font-bold text-gray-900"},"Approval Status Report",-1)),e("p",ie,[t[5]||(t[5]=m(" Track approval workflows and statuses across your organization ",-1)),b.value&&p.value.length>1?(n(),r("span",ue," (Multiple Tenants Selected) ")):C.value?(n(),r("span",ce," (Tenant ID: "+d(C.value)+") ",1)):g("",!0)])]),e("div",ve,[e("div",pe,[e("span",ge,d(((j=a(F).user)==null?void 0:j.name)||"Tenant User"),1),e("span",me,d(b.value?"(Super Admin)":"(Tenant)"),1)])])])])]),e("div",xe,[e("div",be,[t[19]||(t[19]=e("div",{class:"p-6 border-b border-gray-200"},[e("h3",{class:"text-xl font-bold text-gray-900"},"Approval Status Report"),e("p",{class:"text-gray-600 mt-1"},"Configure filters and download your approval workflow data")],-1)),e("div",we,[e("div",ye,[e("div",null,[t[7]||(t[7]=e("label",{class:"block text-gray-700 font-medium mb-2"},"Date Range",-1)),e("div",fe,[(n(),r(y,null,f(M,l=>e("button",{key:l.value,onClick:P=>q(l.value),disabled:a(s).downloadLoading,class:U(["px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",v.value===l.value?"bg-indigo-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"])},d(l.label),11,he)),64))])]),e("div",null,[t[8]||(t[8]=e("label",{class:"block text-gray-700 font-medium mb-2"},"Approval Status",-1)),e("div",_e,[(n(),r(y,null,f(z,l=>e("button",{key:l.value,onClick:P=>H(l.value),disabled:a(s).downloadLoading,class:U(["px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",x.value===l.value?"bg-indigo-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"])},d(l.label),11,ke)),64))])])]),v.value==="custom"?(n(),r("div",Se,[e("div",De,[e("div",null,[t[9]||(t[9]=e("label",{class:"block text-gray-700 text-sm font-medium mb-2"},"Start Date",-1)),T(e("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=l=>i.value=l),disabled:a(s).downloadLoading,max:u.value,class:"w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed"},null,8,Ce),[[E,i.value]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"block text-gray-700 text-sm font-medium mb-2"},"End Date",-1)),T(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=l=>u.value=l),disabled:a(s).downloadLoading,min:i.value,max:O.value,class:"w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed"},null,8,Re),[[E,u.value]])])])])):g("",!0),e("div",Le,[e("div",Ae,[t[15]||(t[15]=e("div",null,[e("h4",{class:"text-lg font-medium text-gray-900"},"Report Actions"),e("p",{class:"text-sm text-gray-600"},"Preview or download your approval status report")],-1)),e("div",Pe,[e("div",Te,[T(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>_.value=l),disabled:a(s).downloadLoading,class:"block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed"},[(n(),r(y,null,f(I,l=>e("option",{key:l.value,value:l.value},d(l.label),9,Me)),64))],8,Fe),[[oe,_.value]])]),e("button",{onClick:W,disabled:a(s).loading||!R.value,class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"},[a(s).loading?(n(),r("svg",Ie,[...t[11]||(t[11]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(n(),r("svg",Ve,[...t[12]||(t[12]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])])),m(" "+d(a(s).loading?"Loading...":"Preview"),1)],8,ze),e("button",{onClick:Y,disabled:a(s).downloadLoading||!R.value,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"},[a(s).downloadLoading?(n(),r("svg",je,[...t[13]||(t[13]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(n(),r("svg",$e,[...t[14]||(t[14]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"},null,-1)])])),m(" "+d(a(s).downloadLoading?"Downloading...":"Download"),1)],8,Be)])])]),a(s).error?(n(),r("div",Ee,[e("div",Ue,[t[18]||(t[18]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),e("div",Ne,[t[16]||(t[16]=e("h3",{class:"text-sm font-medium text-red-800"},"Error",-1)),e("p",Oe,d(a(s).error),1)]),e("div",qe,[e("button",{onClick:t[3]||(t[3]=(...l)=>a(s).clearError&&a(s).clearError(...l)),class:"inline-flex text-red-400 hover:text-red-500"},[...t[17]||(t[17]=[e("svg",{class:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])])])])])):g("",!0)])]),a(s).reportPreview&&a(s).hasReportData?(n(),r("div",He,[e("div",We,[e("div",Ye,[e("div",null,[t[20]||(t[20]=e("h3",{class:"text-xl font-bold text-gray-900"},"Report Preview",-1)),e("p",Ge," Showing "+d(a(s).reportPreview.totalRecords)+" approval records ",1)]),e("div",Je," Last updated: "+d(new Date().toLocaleString()),1)])]),e("div",Ke,[e("table",Qe,[e("thead",Xe,[e("tr",null,[(n(!0),r(y,null,f(a(s).reportPreview.columns,l=>(n(),r("th",{key:l.key,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},d(l.label),1))),128))])]),e("tbody",Ze,[(n(!0),r(y,null,f(a(s).reportPreview.data.slice(0,10),(l,P)=>(n(),r("tr",{key:P,class:"hover:bg-gray-50"},[(n(!0),r(y,null,f(a(s).reportPreview.columns,$=>(n(),r("td",{key:$.key,class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},d(l[$.key]||"-"),1))),128))]))),128))])]),a(s).reportPreview.data.length>10?(n(),r("div",et,[e("p",tt," Showing first 10 of "+d(a(s).reportPreview.totalRecords)+" records. Download the full report to see all data. ",1)])):g("",!0)])])):g("",!0),e("div",ot,[e("div",st,[t[25]||(t[25]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Applied Filters",-1)),e("div",lt,[b.value&&p.value.length>1?(n(),r("div",at,[t[21]||(t[21]=e("span",{class:"font-medium mr-1"},"Tenants:",-1)),m(" "+d(p.value.length)+" selected ",1)])):g("",!0),e("div",rt,[t[22]||(t[22]=e("span",{class:"font-medium mr-1"},"Period:",-1)),m(" "+d(L(v.value))+" ",1),v.value==="custom"&&i.value&&u.value?(n(),r("span",nt," ("+d(w(i.value))+" - "+d(w(u.value))+") ",1)):g("",!0)]),e("div",dt,[t[23]||(t[23]=e("span",{class:"font-medium mr-1"},"Status:",-1)),m(" "+d(A(x.value)),1)]),e("div",it,[t[24]||(t[24]=e("span",{class:"font-medium mr-1"},"Format:",-1)),m(" "+d(V(_.value)),1)])]),t[26]||(t[26]=e("p",{class:"mt-4 text-sm text-gray-600"}," Your report will include approval status data based on the filters above. Use Preview to see a sample of the data before downloading. ",-1))])])])])}}};export{vt as default};
