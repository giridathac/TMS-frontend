import{B as H,r as m,c as F,C as O,D as K,s as P,h as i,i as t,z as w,E as b,G as I,y as k,H as W,w as B,k as $,I as N,v as G,t as l,F as J,l as Q,j as _,n as A,J as E,K as X,e as Z,A as ee,o as d}from"./index-Bqden_Qr.js";const te={class:"bg-white p-6 rounded-xl shadow-sm mb-6"},se={class:"flex items-center justify-between"},oe={class:"bg-white p-6 rounded-xl shadow-sm mb-6"},ae={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ne={class:"relative"},le={key:0,class:"bg-white p-6 rounded-xl shadow-sm flex justify-center"},re={key:1,class:"bg-white p-6 rounded-xl shadow-sm flex justify-center"},ie={class:"flex flex-col items-center text-center"},de={class:"mt-1 text-sm text-gray-500"},ue={key:2,class:"bg-white p-6 rounded-xl shadow-sm"},ce={class:"overflow-x-auto"},ve={class:"min-w-full divide-y divide-gray-200"},ge={class:"bg-white divide-y divide-gray-200"},me={class:"px-6 py-4 whitespace-nowrap"},pe={class:"flex items-center"},xe={class:"ml-4"},fe={class:"text-sm font-medium text-gray-900"},ye={class:"text-xs text-gray-500"},he={class:"px-6 py-4 whitespace-nowrap"},we={class:"text-sm text-gray-900"},be={class:"text-xs text-gray-500"},ke={class:"px-6 py-4 whitespace-nowrap"},_e={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Se=["onClick"],Ce=["onClick"],Be={key:3,class:"bg-white p-8 rounded-xl shadow-sm text-center"},De={class:"mt-6"},Me={key:0,class:"p-4"},Te={class:"space-y-4"},Re={class:"flex justify-between"},Le={class:"text-lg font-medium text-gray-900"},Ve={class:"grid grid-cols-2 gap-4 text-sm"},je={class:"font-medium"},Fe={class:"font-medium"},Ie={class:"font-medium"},$e={class:"font-medium"},Ne={class:"col-span-2"},Ae={class:"font-medium"},Ee={key:0,class:"col-span-2"},qe={class:"font-medium"},Ye={class:"mt-6 flex justify-end space-x-3"},ze={class:"p-4"},Ue={class:"mt-6 flex justify-end space-x-3"},Ke={__name:"MySevaBookings",setup(He){const x=O();ee();const u=H(),D=Z(),S=m(!1),f=m(null),r=m({status:"all",dateRange:"all",search:""}),a=m(null),v=m(!1),g=m(!1),p=F(()=>x.params.id),M=s=>{if(!s)return"";try{return new Date(s).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})}catch(e){return console.error("Error formatting date:",e),""}},T=s=>{if(!s)return"";try{return new Date(s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}catch(e){return console.error("Error formatting time:",e),""}},R=s=>s?s.charAt(0).toUpperCase()+s.slice(1).toLowerCase():"Pending",L=s=>s&&{pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",completed:"bg-blue-100 text-blue-800",cancelled:"bg-red-100 text-red-800",rejected:"bg-red-100 text-red-800"}[s.toLowerCase()]||"bg-gray-100 text-gray-800",V=F(()=>{let s=u.recentSevas||[];if(console.log("All seva bookings before entity filtering:",s),console.log("Current entity ID:",p.value),s=s.filter(e=>{var c;const n=e.entity_id||e.EntityID||((c=e.seva)==null?void 0:c.entity_id),o=parseInt(p.value);return console.log(`Booking entity ID: ${n}, Current entity: ${o}`),parseInt(n)===o}),console.log("Bookings after entity filtering:",s),r.value.status!=="all"&&(s=s.filter(e=>(e.status||e.Status||"").toLowerCase()===r.value.status.toLowerCase())),r.value.dateRange!=="all"){const e=new Date,n=new Date(e.getFullYear(),e.getMonth(),e.getDate()),o=new Date(e);o.setDate(e.getDate()-e.getDay()),o.setHours(0,0,0,0);const c=new Date(e.getFullYear(),e.getMonth(),1),C=new Date(e.getFullYear(),0,1);s=s.filter(j=>{const h=new Date(j.booking_time||j.BookingTime||new Date);switch(r.value.dateRange){case"today":return h>=n;case"week":return h>=o;case"month":return h>=c;case"year":return h>=C;default:return!0}})}if(r.value.search){const e=r.value.search.toLowerCase();s=s.filter(n=>{const o=(n.seva_name||n.seva&&n.seva.name||"").toLowerCase(),c=(n.seva_type||n.seva&&n.seva.type||"").toLowerCase(),C=(n.special_requests||n.SpecialRequests||"").toLowerCase();return o.includes(e)||c.includes(e)||C.includes(e)})}return s}),y=async()=>{S.value=!0,f.value=null;try{console.log("Fetching seva bookings for entity:",p.value),await u.fetchRecentSevas(p.value),console.log("Fetched seva bookings with entity filtering:",u.recentSevas)}catch(s){console.error("Error fetching seva bookings:",s),f.value=s.message||"Failed to load seva bookings"}finally{S.value=!1}},q=s=>{a.value=s,v.value=!0},Y=s=>{a.value=s,g.value=!0},z=()=>{v.value=!1,g.value=!0},U=async()=>{try{const s=a.value.id||a.value.ID;await X.updateBookingStatus(s,"cancelled"),await y(),D.success("Seva booking cancelled successfully"),g.value=!1,v.value=!1}catch(s){console.error("Error cancelling booking:",s),D.error("Failed to cancel booking: "+(s.message||"Unknown error"))}};return K(()=>x.params.id,(s,e)=>{s&&s!==e&&(console.log("Entity changed from",e,"to",s),y())}),P(async()=>{await y(),console.log("Final sevaStore state:",{recentSevas:u.recentSevas,sevaCatalog:u.sevaCatalog,loadingRecentSevas:u.loadingRecentSevas,loadingCatalog:u.loadingCatalog,currentEntityId:p.value})}),(s,e)=>{const n=W("router-link");return d(),i("div",null,[t("div",te,[t("div",se,[e[8]||(e[8]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900"},"My Seva Bookings"),t("p",{class:"text-gray-600 mt-1"},"View and manage all your seva bookings")],-1)),w(n,{to:`/entity/${k(x).params.id}/devotee/seva-booking`,class:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none"},{default:b(()=>[...e[7]||(e[7]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),I(" Book New Seva ",-1)])]),_:1},8,["to"])])]),t("div",oe,[t("div",ae,[t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Status",-1)),B(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>r.value.status=o),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"},[...e[9]||(e[9]=[N('<option value="all">All Statuses</option><option value="pending">Pending</option><option value="approved">Approved</option><option value="completed">Completed</option><option value="cancelled">Cancelled</option>',5)])],512),[[$,r.value.status]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Date Range",-1)),B(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>r.value.dateRange=o),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"},[...e[11]||(e[11]=[N('<option value="all">All Time</option><option value="today">Today</option><option value="week">This Week</option><option value="month">This Month</option><option value="year">This Year</option>',5)])],512),[[$,r.value.dateRange]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Search",-1)),t("div",ne,[B(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>r.value.search=o),type:"text",placeholder:"Search seva name...",class:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"},null,512),[[G,r.value.search]]),e[13]||(e[13]=t("svg",{class:"absolute left-3 top-2.5 h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))])])])]),S.value||k(u).loadingRecentSevas||k(u).loadingCatalog?(d(),i("div",le,[...e[15]||(e[15]=[t("div",{class:"flex flex-col items-center"},[t("div",{class:"animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"}),t("p",{class:"mt-2 text-gray-600"},"Loading your seva bookings...")],-1)])])):f.value?(d(),i("div",re,[t("div",ie,[e[16]||(e[16]=t("svg",{class:"h-10 w-10 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e[17]||(e[17]=t("h3",{class:"mt-2 text-lg font-medium text-gray-900"},"Error loading seva bookings",-1)),t("p",de,l(f.value),1),t("button",{onClick:y,class:"mt-3 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none"}," Try Again ")])])):V.value.length>0?(d(),i("div",ue,[t("div",ce,[t("table",ve,[e[19]||(e[19]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Seva "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Date & Time "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status "),t("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),t("tbody",ge,[(d(!0),i(J,null,Q(V.value,o=>(d(),i("tr",{key:o.id||o.ID,class:"hover:bg-gray-50"},[t("td",me,[t("div",pe,[e[18]||(e[18]=t("div",{class:"flex-shrink-0 h-10 w-10 bg-indigo-100 rounded-full flex items-center justify-center"},[t("svg",{class:"h-5 w-5 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 002 2z"})])],-1)),t("div",xe,[t("div",fe,l(o.seva_name||o.seva&&o.seva.name||`Seva ${o.seva_id||o.SevaID||""}`),1),t("div",ye,l(o.seva_type||o.seva&&o.seva.type||""),1)])])]),t("td",he,[t("div",we,l(M(o.booking_time||o.BookingTime)),1),t("div",be,l(T(o.booking_time||o.BookingTime)),1)]),t("td",ke,[t("span",{class:A([L(o.status||o.Status),"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},l(R(o.status||o.Status)),3)]),t("td",_e,[t("button",{onClick:c=>q(o),class:"text-indigo-600 hover:text-indigo-900 mr-3"}," View ",8,Se),(o.status||o.Status||"").toLowerCase()==="pending"?(d(),i("button",{key:0,onClick:c=>Y(o),class:"text-red-600 hover:text-red-900"}," Cancel ",8,Ce)):_("",!0)])]))),128))])])])])):(d(),i("div",Be,[e[21]||(e[21]=t("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 002 2z"})],-1)),e[22]||(e[22]=t("h3",{class:"mt-2 text-lg font-medium text-gray-900"},"No seva bookings found",-1)),e[23]||(e[23]=t("p",{class:"mt-1 text-sm text-gray-500"},"You haven't booked any sevas yet for this temple.",-1)),t("div",De,[w(n,{to:`/entity/${k(x).params.id}/devotee/seva-booking`,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none"},{default:b(()=>[...e[20]||(e[20]=[I(" Book Your First Seva ",-1)])]),_:1},8,["to"])])])),w(E,{show:v.value,onClose:e[4]||(e[4]=o=>v.value=!1),title:"Booking Details"},{default:b(()=>[a.value?(d(),i("div",Me,[t("div",Te,[t("div",Re,[t("h3",Le,l(a.value.seva_name||a.value.seva&&a.value.seva.name||`Seva ${a.value.seva_id||a.value.SevaID||""}`),1),t("span",{class:A([L(a.value.status||a.value.Status),"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},l(R(a.value.status||a.value.Status)),3)]),t("div",Ve,[t("div",null,[e[24]||(e[24]=t("p",{class:"text-gray-500"},"Booking Date",-1)),t("p",je,l(M(a.value.booking_time||a.value.BookingTime)),1)]),t("div",null,[e[25]||(e[25]=t("p",{class:"text-gray-500"},"Booking Time",-1)),t("p",Fe,l(T(a.value.booking_time||a.value.BookingTime)),1)]),t("div",null,[e[26]||(e[26]=t("p",{class:"text-gray-500"},"Amount",-1)),t("p",Ie,"â‚¹"+l(a.value.price||a.value.amount||0),1)]),t("div",null,[e[27]||(e[27]=t("p",{class:"text-gray-500"},"Type",-1)),t("p",$e,l(a.value.seva_type||a.value.seva&&a.value.seva.type||""),1)]),t("div",Ne,[e[28]||(e[28]=t("p",{class:"text-gray-500"},"Description",-1)),t("p",Ae,l(a.value.seva_description||a.value.seva&&a.value.seva.description||"No description available"),1)]),a.value.special_requests||a.value.SpecialRequests?(d(),i("div",Ee,[e[29]||(e[29]=t("p",{class:"text-gray-500"},"Special Requests",-1)),t("p",qe,l(a.value.special_requests||a.value.SpecialRequests),1)])):_("",!0)])]),t("div",Ye,[t("button",{onClick:e[3]||(e[3]=o=>v.value=!1),class:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50"}," Close "),(a.value.status||a.value.Status||"").toLowerCase()==="pending"?(d(),i("button",{key:0,onClick:z,class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none"}," Cancel Booking ")):_("",!0)])])):_("",!0)]),_:1},8,["show"]),w(E,{show:g.value,onClose:e[6]||(e[6]=o=>g.value=!1),title:"Cancel Seva Booking"},{default:b(()=>[t("div",ze,[e[30]||(e[30]=t("p",{class:"text-gray-700"},"Are you sure you want to cancel this seva booking? This action cannot be undone.",-1)),t("div",Ue,[t("button",{onClick:e[5]||(e[5]=o=>g.value=!1),class:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50"}," No, Keep Booking "),t("button",{onClick:U,class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none"}," Yes, Cancel Booking ")])])]),_:1},8,["show"])])}}};export{Ke as default};
