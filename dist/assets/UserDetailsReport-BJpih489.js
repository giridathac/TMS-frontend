import{q as Q,e as X,r as v,c as y,C as Z,s as ee,h as n,j as x,i as e,z as te,E as se,H as le,G as m,t as o,y as oe,F as S,l as C,w as R,v as j,k as ae,V as ne,A as de,o as d,n as U}from"./index-Bqden_Qr.js";const ie={class:"min-h-screen bg-gray-50"},re={key:0,class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-4"},ue={class:"bg-white shadow-sm border-b border-gray-200 rounded-2xl"},ce={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},ve={class:"flex items-center justify-between"},me={class:"text-gray-600 mt-1"},ge={key:0,class:"text-indigo-600 font-medium"},be={key:1,class:"text-indigo-600 font-medium"},pe={class:"flex items-center space-x-4"},xe={class:"bg-indigo-50 px-4 py-2 rounded-lg border border-indigo-200"},fe={class:"text-indigo-800 font-medium"},ye={class:"text-indigo-600 text-sm ml-2"},we={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},he={class:"bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden mb-8"},_e={class:"p-6"},ke={class:"mb-6"},De={class:"flex flex-wrap gap-2"},Se=["onClick","disabled"],Ce={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},Re={class:"flex flex-wrap gap-2"},Ue=["onClick","disabled"],Te={class:"flex flex-wrap gap-2"},Fe=["onClick","disabled"],Ae={key:0,class:"mb-6 p-4 bg-gray-50 border border-gray-200 rounded-lg"},Ie={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ve=["disabled","max"],Me=["disabled","min","max"],Le={class:"border-t border-gray-200 pt-6"},Be={class:"flex flex-col md:flex-row md:items-center md:justify-between"},ze={class:"flex items-center space-x-3"},Ee={class:"relative"},je=["disabled"],Oe=["value"],$e=["disabled"],qe={key:0,class:"animate-spin -ml-1 mr-2 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ne={key:1,class:"mr-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Pe={key:1,class:"mt-4 p-4 bg-red-50 border border-red-200 rounded-md"},He={class:"flex"},Ye={class:"ml-3"},Ge={class:"mt-1 text-sm text-red-700"},We={class:"bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden"},Je={class:"p-6"},Ke={class:"flex flex-wrap gap-2"},Qe={key:0,class:"inline-flex items-center px-3 py-1.5 rounded-full text-sm bg-indigo-100 text-indigo-800"},Xe={class:"inline-flex items-center px-3 py-1.5 rounded-full text-sm bg-indigo-100 text-indigo-800"},Ze={class:"inline-flex items-center px-3 py-1.5 rounded-full text-sm bg-indigo-100 text-indigo-800"},et={key:0},tt={class:"inline-flex items-center px-3 py-1.5 rounded-full text-sm bg-indigo-100 text-indigo-800"},st={class:"inline-flex items-center px-3 py-1.5 rounded-full text-sm bg-indigo-100 text-indigo-800"},at={__name:"UserDetailsReport",setup(lt){const w=Z();de();const T=Q(),{showToast:F}=X(),g=v("all"),c=v("monthly"),b=v("all"),h=v("pdf"),r=v(""),u=v(""),i=v(!1),_=v(""),O=()=>{const s=new Date,t=new Date;t.setDate(s.getDate()-30),u.value=s.toISOString().split("T")[0],r.value=t.toISOString().split("T")[0]},A=[{label:"All Roles",value:"all"},{label:"Tenant",value:"tenant"},{label:"Devotee",value:"devotee"},{label:"Volunteer",value:"volunteer"},{label:"Standard User",value:"standarduser"},{label:"Monitoring User",value:"monitoringuser"}],I=[{label:"Weekly",value:"weekly"},{label:"Monthly",value:"monthly"},{label:"Yearly",value:"yearly"},{label:"Custom Range",value:"custom"}],V=[{label:"All Status",value:"all"},{label:"Active",value:"active"},{label:"Inactive",value:"inactive"},{label:"Locked",value:"locked"}],M=[{label:"PDF",value:"pdf"},{label:"CSV",value:"csv"},{label:"Excel",value:"excel"}],k=y(()=>{var s;return w.params.tenantId||((s=T.user)==null?void 0:s.id)||localStorage.getItem("current_tenant_id")}),p=y(()=>w.query.from==="superadmin"),f=y(()=>w.query.tenants?w.query.tenants.split(","):[k.value]),$=y(()=>new Date().toISOString().split("T")[0]),L=y(()=>c.value==="custom"?r.value&&u.value&&new Date(r.value)<=new Date(u.value):!0),q=s=>{g.value=s,D()},N=s=>{c.value=s,D();const t=new Date,a=new Date;s==="weekly"?a.setDate(t.getDate()-7):s==="monthly"?a.setDate(t.getDate()-30):s==="yearly"&&a.setDate(t.getDate()-365),s!=="custom"&&(r.value=a.toISOString().split("T")[0],u.value=t.toISOString().split("T")[0])},P=s=>{b.value=s,D()},D=()=>{_.value=""},H=s=>{const t=A.find(a=>a.value===s);return t?t.label:"Unknown"},Y=s=>{const t=I.find(a=>a.value===s);return t?t.label:"Unknown"},G=s=>{const t=V.find(a=>a.value===s);return t?t.label:"Unknown"},W=s=>{const t=M.find(a=>a.value===s);return t?t.label:"Unknown"},B=s=>s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",J=()=>{if(p.value&&f.value.length>1){const s={entityIds:f.value,dateRange:c.value,role:g.value!=="all"?g.value:void 0,status:b.value!=="all"?b.value:void 0};return c.value==="custom"&&(s.startDate=r.value,s.endDate=u.value),s}else{const s={entityId:k.value,dateRange:c.value,role:g.value!=="all"?g.value:void 0,status:b.value!=="all"?b.value:void 0};return c.value==="custom"&&(s.startDate=r.value,s.endDate=u.value),s}},K=async()=>{if(!(i.value||!L.value)){D(),i.value=!0;try{const s={...J(),format:h.value,isSuperAdmin:p.value};console.log("Downloading User Details report with the following parameters:",s);const t=await ne.downloadUserDetailsReport(s);F(`User Details Report downloaded successfully: ${t.filename}`,"success")}catch(s){console.error("Download failed:",s),_.value=s.message||"Failed to download report. Please try again.",F(`Download failed: ${s.message}`,"error")}finally{i.value=!1}}};return ee(()=>{O()}),(s,t)=>{var z;const a=le("router-link");return d(),n("div",ie,[p.value?(d(),n("div",re,[te(a,{to:"/superadmin/reports",class:"inline-flex items-center px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"},{default:se(()=>[...t[3]||(t[3]=[e("svg",{class:"mr-2 h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),m(" Back to SuperAdmin Reports ",-1)])]),_:1})])):x("",!0),e("div",ue,[e("div",ce,[e("div",ve,[e("div",null,[t[5]||(t[5]=e("h1",{class:"text-2xl font-bold text-gray-900"},"User Details Report",-1)),e("p",me,[t[4]||(t[4]=m(" Comprehensive user information and activity statistics ",-1)),p.value&&f.value.length>1?(d(),n("span",ge," (Multiple Tenants Selected) ")):k.value?(d(),n("span",be," (Tenant ID: "+o(k.value)+") ",1)):x("",!0)])]),e("div",pe,[e("div",xe,[e("span",fe,o(((z=oe(T).user)==null?void 0:z.name)||"Tenant User"),1),e("span",ye,o(p.value?"(Super Admin)":"(Tenant)"),1)])])])])]),e("div",we,[e("div",he,[t[16]||(t[16]=e("div",{class:"p-6 border-b border-gray-200"},[e("h3",{class:"text-xl font-bold text-gray-900"},"User Details"),e("p",{class:"text-gray-600 mt-1"},"Configure filters and download your user details data")],-1)),e("div",_e,[e("div",ke,[t[6]||(t[6]=e("label",{class:"block text-gray-700 font-medium mb-2"},"User Roles",-1)),e("div",De,[(d(),n(S,null,C(A,l=>e("button",{key:l.value,onClick:E=>q(l.value),disabled:i.value,class:U(["px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",g.value===l.value?"bg-indigo-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"])},o(l.label),11,Se)),64))])]),e("div",Ce,[e("div",null,[t[7]||(t[7]=e("label",{class:"block text-gray-700 font-medium mb-2"},"Registration Date",-1)),e("div",Re,[(d(),n(S,null,C(I,l=>e("button",{key:l.value,onClick:E=>N(l.value),disabled:i.value,class:U(["px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",c.value===l.value?"bg-indigo-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"])},o(l.label),11,Ue)),64))])]),e("div",null,[t[8]||(t[8]=e("label",{class:"block text-gray-700 font-medium mb-2"},"User Status",-1)),e("div",Te,[(d(),n(S,null,C(V,l=>e("button",{key:l.value,onClick:E=>P(l.value),disabled:i.value,class:U(["px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",b.value===l.value?"bg-indigo-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"])},o(l.label),11,Fe)),64))])])]),c.value==="custom"?(d(),n("div",Ae,[e("div",Ie,[e("div",null,[t[9]||(t[9]=e("label",{class:"block text-gray-700 text-sm font-medium mb-2"},"Start Date",-1)),R(e("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=l=>r.value=l),disabled:i.value,max:u.value,class:"w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed"},null,8,Ve),[[j,r.value]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"block text-gray-700 text-sm font-medium mb-2"},"End Date",-1)),R(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=l=>u.value=l),disabled:i.value,min:r.value,max:$.value,class:"w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed"},null,8,Me),[[j,u.value]])])])])):x("",!0),e("div",Le,[e("div",Be,[t[13]||(t[13]=e("div",{class:"mb-4 md:mb-0"},[e("h4",{class:"text-lg font-medium text-gray-900"},"Download Report"),e("p",{class:"text-sm text-gray-600"},"Select a format and click download")],-1)),e("div",ze,[e("div",Ee,[R(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>h.value=l),disabled:i.value,class:"block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed"},[(d(),n(S,null,C(M,l=>e("option",{key:l.value,value:l.value},o(l.label),9,Oe)),64))],8,je),[[ae,h.value]])]),e("button",{onClick:K,disabled:i.value||!L.value,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"},[i.value?(d(),n("svg",qe,[...t[11]||(t[11]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(d(),n("svg",Ne,[...t[12]||(t[12]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"},null,-1)])])),m(" "+o(i.value?"Downloading...":"Download"),1)],8,$e)])])]),_.value?(d(),n("div",Pe,[e("div",He,[t[15]||(t[15]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),e("div",Ye,[t[14]||(t[14]=e("h3",{class:"text-sm font-medium text-red-800"},"Error",-1)),e("p",Ge,o(_.value),1)])])])):x("",!0)])]),e("div",We,[e("div",Je,[t[22]||(t[22]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Applied Filters",-1)),e("div",Ke,[p.value&&f.value.length>1?(d(),n("div",Qe,[t[17]||(t[17]=e("span",{class:"font-medium mr-1"},"Tenants:",-1)),m(" "+o(f.value.length)+" selected ",1)])):x("",!0),e("div",Xe,[t[18]||(t[18]=e("span",{class:"font-medium mr-1"},"Role:",-1)),m(" "+o(H(g.value)),1)]),e("div",Ze,[t[19]||(t[19]=e("span",{class:"font-medium mr-1"},"Period:",-1)),m(" "+o(Y(c.value))+" ",1),c.value==="custom"&&r.value&&u.value?(d(),n("span",et," ("+o(B(r.value))+" - "+o(B(u.value))+") ",1)):x("",!0)]),e("div",tt,[t[20]||(t[20]=e("span",{class:"font-medium mr-1"},"Status:",-1)),m(" "+o(G(b.value)),1)]),e("div",st,[t[21]||(t[21]=e("span",{class:"font-medium mr-1"},"Format:",-1)),m(" "+o(W(h.value)),1)])]),t[23]||(t[23]=e("p",{class:"mt-4 text-sm text-gray-600"}," Your report will include data based on the filters above. Click Download to generate and download the report. ",-1))])])])])}}};export{at as default};
